---
title: "CCES cumulative"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rprojroot)
```

Directory for building a CCES cumulative file (2006 - 2016) collaboratively. Follow the development of dataset building at [this Github page](https://github.com/kuriwaki/cces_cumulative). Project page of tasks [here](https://github.com/kuriwaki/cces_cumulative/projects/1).

A 2006-2012 cumulative file, as well as datasets from individual years, can be found at the CCES homepage: https://cces.gov.harvard.edu/

Please feel free to file any questions or requests about the cumulative file as [Github issues](https://github.com/kuriwaki/cces_cumulative/issues). 

Data is currently not tracked, but releases will be made as flat files and a [Crunch dataset](crunch.io). For an intermediate dataset, please sign up here: <https://harvard.az1.qualtrics.com/jfe/form/SV_066hQi4Eeco3Kap>.

# Getting Started 

The `.Rds` format can be read into R. This format preserves dataset properties such as the distinction between integers and doubles, and labelled variables.

```{r, echo = FALSE, include = FALSE}
df <- readRDS(find_rstudio_root_file("data/release/cumulative_2006_2016.Rds"))
```

```{r, eval = FALSE, echo = TRUE}
df <- readRDS("cumulative_2006_2016.Rds")
```

```{r}
library(tidyverse)
df
```


# What's New

## Unified Variable Names

## Candidate Names and Identifiers
One addition to this cumulative dataset above the individual years that comprise it is the addition of candidate name and identifiers that a respondent chose. In the individual year's CCES datasets, typically the response values for a vote choice question is a generic label, e.g. `Candidate1` and `Candidate2`. Then, separate variables with those names are appended, requiring users to look-up the relevant candidate for each respondent. The cumulative dataset shows both the generic label _and_ the chosen candidate's name, party, and identifier, which will vary across individuals. 

```{r, echo = TRUE}
select(df, year, case_id, st, matches("voted_sen"))
```

## Crunch



# Code Organization

R scripsts `01` - `06` reproduce the cumulative dataset starting from each year's CCES on dataverse. 

- `01_define-names-labels.R` constructs two variable name tables -- one that names andibes each variable to be in the final dataset, and another that indicates which varalias corresponds to the candidate columns in each year's CCES.
- `02_read-common.R` pulls out the common contents with minimal foramtting (e.g. staze record ID variable names)
- `03_prepare-fixes.R` makes some fixes to variables in each year's datasets.
- `04_stack-cumulative.R` pulls out the variabales of interest from annual CCES filen, we stack this into a long dataset where each row is a respondent from CCES.
- `05_extract_contextual.R` pulls out the "contextual variables" at the respondent leve. information on candidates and representatives. It uses some long format voting restables from `04`.
- `06_merge-contextual_upload.R` combines all the variables together, essentially colnding the output of `04` on `05`. Saves a `.Rds` and `sav` version. 
- `07_format-crunch.R` logs into Crunch, and adds variable names, descriptions, groupings, and other Crunch attributes to the Crunch dataset. It also adds variables and exports a `.dta` version


More scripts in `00_prepare` format other datasets like NOMINATE, CQ, and DIME. 




