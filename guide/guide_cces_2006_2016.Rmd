---
title: "CCES Cumulative Common Content (2006 - 2016) Codebook"
author: "Shiro Kuriwaki"
thanks: "Department of Government, Harvard University. www.shirokuriwaki.com"
date: "Codebook Last Updated: `r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
    template: sk_helvet.sty
    toc: yes
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = "")
```

```{r, include = FALSE}
library(crunch)
library(glue)
library(tidyverse)
library(haven)
library(rprojroot)
```
```{r include = FALSE}
df <- readRDS(find_rstudio_root_file("data/release/cumulative_2006_2016.Rds"))
# saveRDS(sample_frac(df, 0.01), "data/release/temp_sample.Rds")
meta <- readRDS(find_rstudio_root_file("data/output/02_questions/cumulative_vartable.Rds"))
```

```{r}
print_tab <- function(var, do_sort = FALSE, tbl = df) {
  var <- enquo(var)
  
  tal <- tbl %>% 
    mutate_if(is.labelled, as_factor) %>% 
    group_by(!!var) %>% 
    tally(sort = do_sort)
  
  dframe <- as.data.frame(tal)
  
  print(dframe, row.names = FALSE)
  cat("\n\n")
}
```

```{r}
print_numeric <- function(var, tbl = df) {
  var <- enquo(var)
  
  summary(pull(df, !!var))
}
```


```{r}
in_years <- function(var, tbl = df) {
  var <- enquo(var)
  
  yrs_vec <- tbl %>% 
    filter(!is.na(!!var)) %>% 
    distinct(year) %>% 
    arrange(year) %>%
    pull() 
  
  if (identical(yrs_vec, as.numeric(2006:2016))) return("All of 2006-2016")  
  if (!identical(yrs_vec, as.numeric(2006:2016))) return(str_c(yrs_vec, collapse = ", "))
}
```

```{r}
descrip <- function(var, tbl = meta) {
  varchar <- quo_name(enquo(var))
  tbl$description[tbl$alias == varchar]
}
```

```{r}
nam <- function(var, tbl = meta) {
  varchar <- quo_name(enquo(var))
  glue("`{varchar}`: {tbl$name[tbl$alias == varchar]}")
}
```

This dataset combines responses from eleven years (2006 - 2016) of the Cooperative Congressional Election Study (CCES, Principal Investigators: Stephen Ansolabehere, Brian Schaffner, and Sam Luks). 

The CCES is an online survey conducted around November of each year, asking a wide range of questions on political behavior and public opinion. One particular strength of the CCES is its relatively large sample size that covers all Congressional districts. While questions can change from year to year, some standard questions, as this compiled file contains, afford comparison. 

The dataset was constructed based off the public flat file CCES datasets from each year. A set of R scripts formatted, merged, and standardized these datasets to generate a `tibble`-style data frame in `R`. A `Stata` `.dta` file is also provided, generated from the `haven` package. In addition, the same data frame is uploaded to a `Crunch` interface, a new online tool (in beta at the time of writing) that makes data visualization and tabulation intuitive and sharable.  

This dataset sometimes standardizes responses whose question wording or response options that have changed slightly over years. These modifications are only made when differences are deemed sufficiently minor, and are documented in source code (see below). However, for details on the survey methodology and a list of all questions, readers should consult the guides for each year.  


* For source code that created this dataset's variables and formatting, see the Github repository <https://github.com/kuriwaki/cces_cumulative>
* To report a bug in the dataset or ask a question about the build process, please feel free to file an issue at the same page, <https://github.com/kuriwaki/cces_cumulative/issues>. Alternatively, please contact me by email: <kuriwaki@g.harvard.edu>
* The CCES homepage is <https://cces.gov.harvard.edu/>
* For each year's CCES datasets and more, search the CCES dataverse: <https://dataverse.harvard.edu/dataverse/cces>
* A cumulative file for 2006-2012, in a slightly different format, is:  Ansolabehere, Stephen; Pettigrew, Stephen, 2014, ["Cumulative CCES Common Content (2006-2012)"](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/26451), <doi:10.7910/DVN/26451>, Harvard Dataverse, V5, UNF:`5:rXSA73aoDi28uu+IOg7DEg==`
* To read more on the survey methodology, consult the Methodology section of the most recent Common Content's codebook: Ansolabehere, Stephen; Schaffner, Brian F., 2017, "CCES Common Content, 2016", <doi:10.7910/DVN/GDF6Z0>, Harvard Dataverse, V3, UNF:`6:Hacct7qJt1WXOGPb63A5Gg==`
* NOMINATE data on incumbents relies on: Lewis, Jeffrey B., Keith Poole, Howard Rosenthal, Adam Boche, Aaron Rudkin, and Luke Sonnet (2017). Voteview: Congressional Roll-Call Votes Database. <https://voteview.com/>
* FEC data on candidates and governors relies on: Bonica, Adam , 2015, "Database on Ideology, Money in Politics, and Elections (DIME)", <doi:10.7910/DVN/O5PX0B>, Harvard Dataverse, V2



The sections below provide summary more information on each variable. 

* The title is followed by the name of the variable in the dataset ("alias" in Crunch) followed by the variable label ("name" in Crunch).
* Question wordings, where applicable, immediately follow. Otherwise an description is provide in square brackets ("[]"). All square brackets, both in the description and the response options, indicate descriptions that are summaries of what the respondent saw (rather than the verbatim response). 
* A tabulation of response options (or summary statistics for numeric variables) follow. Numbers are unweighted counts. Options are ordered by the ordering of the options. 
* The "Years" variable lists the years of the CCES in which data on the variable is available at all. If a year is not listed, either the question was not asked in the year or was not incorporate in the creation of this dataset. 
* Finally, "Limitations" notes some of the caveats required when interpreting this variable. As this dataset is synthetic, some year-specific details on implementation are inevitably lost.
 
 
 
# Administration


### `r nam(year)`

`r descrip(year)`

```{r}
print_tab(year)
```

### `r nam(starttime)`

`r descrip(starttime)`

```{r}
print_numeric(starttime)
```
* Years: `r in_years(starttime)`


### `r nam(tookpost)`

`r descrip(tookpost)`

```{r}
print_tab(tookpost)
```

* Years: `r in_years(tookpost)` (Post-election wave only exists for even years)




# Weights 
### `r nam(weight)`

`r descrip(weight)`

```{r}
print_numeric(weight)
```

* Years: `r in_years(weight)`
* The weights applied to the sample (which is originally drawn from a matched sample) are constructed to make each year's respondents' pool representative of the national adult population. See the methodology section of the [2016 Guide](https://dataverse.harvard.edu/api/access/datafile/3047286) for details. 
* Limitations: Only specific to each year. Built off of the entire pre-election wave sample, but not necessarily to adjust post-election wave respondents. 


### `r nam(weight_cumulative)`

`r descrip(weight_cumulative)`


```{r}
print_numeric(weight_cumulative)
```

* Years: `r in_years(weight_cumulative)`
* Limitations: Only a simple transformation of `weight`



### `r nam(weight_vv)`

`r descrip(weight_vv)`


```{r}
print_numeric(weight_vv)
```

* Years: `r in_years(weight_vv)`
* Limitations: Only available for some even years.

### `r nam(weight_vv_post)`

`r descrip(weight_vv_post)`

```{r}
print_numeric(weight_vv_post)
```

* Years: `r in_years(weight_vv_post)`
* Limitations: Only available for some even years.



# Geography

A series of variables for the respondent's location

* `r nam(state)`: `r descrip(state)`
* `r nam(st)`: `r descrip(st)`
* `r nam(dist)`: `r descrip(dist)`
* `r nam(dist_up)`: `r descrip(dist_up)`
* `r nam(CD)`: `r descrip(CD)`
* `r nam(zipcode)`: `r descrip(zipcode)`
* `r nam(countyFIPS)`: `r descrip(countyFIPS)`

```{r}
df %>%
  mutate(is_2012 = year == 2012) %>%
  arrange(desc(is_2012)) %>%
  select(matches("(state|^st$|dist|CD|zipcode|countyFIPS)")) %>% 
  glimpse()
```

* Years: `r in_years(state)`
* Limitations: Some years do not provide the variable relevant to `dist_up`, in which case the current district (`dist`) is assigned automatically. Thus, `dist_up` may not reflect, for example, district changes in off-cycle redistricting.  Only residence (not registration) geographies included here; see individual years' for registration geographies.


# Demographics

### `r nam(gender)`

`r descrip(gender)`


```{r}
print_tab(gender)
```

* Years: `r in_years(gender)`

### `r nam(birthyr)`

`r descrip(birthyr)`


```{r}
print_numeric(birthyr)
```

* Years: `r in_years(birthyr)`

### `r nam(age)`

`r descrip(age)`


```{r}
print_numeric(age)
```

* Years: `r in_years(age)`

### `r nam(educ)`

`r descrip(educ)`


```{r}
print_tab(educ)
```

* Years: `r in_years(educ)`

### `r nam(race)`

`r descrip(race)`


```{r}
print_tab(race)
```

* Years: `r in_years(race)`


# Presidential Vote

### `r nam(intent_pres_08)`

`r descrip(intent_pres_08)`


```{r}
print_tab(intent_pres_08)
```

* Years: `r in_years(intent_pres_08)`


### `r nam(intent_pres_12)`

`r descrip(intent_pres_12)`


```{r}
print_tab(intent_pres_12)
```

* Years: `r in_years(intent_pres_12)`

### `r nam(intent_pres_16)`

`r descrip(intent_pres_16)`


```{r}
print_tab(intent_pres_16)
```

* Years: `r in_years(intent_pres_16)`


### `r nam(voted_pres_08)`

`r descrip(voted_pres_08)`


```{r}
print_tab(voted_pres_08)
```

* Years: `r in_years(voted_pres_08)`
* Limitations: Response options offer slightly by year; some are collapsed into one. 

### `r nam(voted_pres_12)`

`r descrip(voted_pres_12)`


```{r}
print_tab(voted_pres_12)
```

* Years: `r in_years(voted_pres_12)`
* Limitations: Response options offer slightly by year; some are collapsed into one. 

### `r nam(voted_pres_16)`

`r descrip(voted_pres_16)`

* Years: `r in_years(voted_pres_16)`

```{r}
print_tab(voted_pres_16)
```



# Identity and Attitudes

## Partisan Identity

### `r nam(pid3)`

`r descrip(pid3)`

```{r}
print_tab(pid3)
```

* Years: `r in_years(pid3)`
* Limitations: Response options offer slightly by year. For example, the `Not Sure` option is not a response option in years 2006 and 2010.  Open-text responses not included. 

### `r nam(pid7)`

`r descrip(pid7)`

```{r}
print_tab(pid7)
```

* Years: `r in_years(pid7)`
* Limitations: See `pid3` 

## Economy
### `r nam(economy_retro)`

`r descrip(economy_retro)`

```{r}
print_tab(economy_retro)
```

* Years: `r in_years(economy_retro)`
* Limitations: Response options varies by year. Some are collapsed into one category (e.g. `Gotten Better`, presented in some years, and `Gotten Somewhat Better`, presented in other years, are collapsed into `Gotten Better / Somewhat Better`). Some are left as is. For example, `Not Sure` was not an option in 2009.


## Approval

### `r nam(approval_pres)`

`r descrip(approval_pres)`


```{r}
print_tab(approval_pres)
```

* Years: `r in_years(approval_pres)`
* Limitations: `Neither approve nor disapprove` only included in 2007.
* This question is asked in a grid format, along with Governors, Congress, and Courts. 

### `r nam(approval_rep)`

`r descrip(approval_rep)`


```{r}
print_tab(approval_rep)
```

* Years: `r in_years(approval_rep)`
* Limitations: `Neither approve nor disapprove` only included in 2007.
* This question is asked in a grid format, along with Senators (`approval_sen1`, `approval_sen2`). 
* To see who [Representative] refers to for a particular respondent, see `rep_inc` (incumbent identifier in `rep_icpsr`)

### `r nam(approval_sen1)`

`r descrip(approval_sen1)`


```{r}
print_tab(approval_sen1)
```

* Years: `r in_years(approval_sen1)`
* Limitations: : Response options varies by year. Some are collapsed into one category (e.g. `Approve`, presented in some years, and `Somewhat Approve`, presented in other years, are collapsed into `Approve / Somewhat Approve`). `Neither approve nor disapprove` only included in 2007.
* To see who [Senator 1] refers to for a particular respondent, see `sen1_inc` (incumbent identifier in `sen1_icpsr`)

### `r nam(approval_sen2)`

`r descrip(approval_sen2)`


```{r}
print_tab(approval_sen2)
```

* See `approval_sen2`

### `r nam(approval_gov)`

`r descrip(approval_gov)`


```{r}
print_tab(approval_gov)
```

* Years: `r in_years(approval_gov)`
* Limitations: See `approval_pres`
* To see who the Governor refers to for a particular respondent, see `gov_inc` (incumbent identifier in `gov_fec`, if applicable).


# Voting

## Preference

### `r nam(intent_rep)`

`r descrip(intent_rep)`

* Years: `r in_years(intent_rep)`

```{r}
print_tab(intent_rep)
```

### `r nam(intent_sen)`

`r descrip(intent_sen)`

* Years: `r in_years(intent_sen)`

```{r}
print_tab(intent_sen)
```

### `r nam(intent_gov)`

`r descrip(intent_gov)`

* Years: `r in_years(intent_gov)`

```{r}
print_tab(intent_gov)
```


## Vote Choice

### `r nam(voted_rep)`

`r descrip(voted_rep)`

* Years: `r in_years(voted_rep)`

```{r}
print_tab(voted_rep)
```

### `r nam(voted_sen)`

`r descrip(voted_sen)`

* Years: `r in_years(voted_sen)`

```{r}
print_tab(voted_sen)
```

### `r nam(voted_gov)`

`r descrip(voted_gov)`

* Years: `r in_years(voted_gov)`

```{r}
print_tab(voted_gov)
```





# Validations 

### `r nam(vv_regstatus)`

`r descrip(vv_regstatus)`

* Years: `r in_years(vv_regstatus)`

```{r}
print_tab(vv_regstatus)
```

### `r nam(vv_party_gen)`

`r descrip(vv_party_gen)`

* Years: `r in_years(vv_party_gen)`


```{r}
print_tab(vv_party_gen)
```



### `r nam(vv_party_prm)`

`r descrip(vv_party_prm)`

* Years: `r in_years(vv_party_prm)`

```{r}
print_tab(vv_party_prm)
```


## Turnout 

### `r nam(vv_turnout_gvm)`

`r descrip(vv_turnout_gvm)`

* Years: `r in_years(vv_turnout_gvm)`

```{r}
print_tab(vv_turnout_gvm)
```


### `r nam(vv_turnout_pvm)`

`r descrip(vv_turnout_pvm)`

* Years: `r in_years(vv_turnout_pvm)`


```{r}
print_tab(vv_turnout_pvm)
```




# Text

## Identifiers
```{r}
glimpse(select(df, matches("case_id")))
```

## Current Representatives

### Incumbents
```{r}
glimpse(select(df, matches("(rep|sen1|sen2|gov)_.inc")))
```

### Incumbent Identifiers
```{r}
glimpse(select(df, matches("(rep|sen1|sen2|gov)_.*(icpsr)"), gov_fec))
```

## Candidates

### Chosen
```{r}
glimpse(select(df, matches("(intent|voted)_.*chosen")))
```


### Candidate Identifiers
```{r}
glimpse(select(df, matches("(intent|voted)_.*fec")))
```
